/*!
 * Untappd Ratings for WooCommerce
 * https://github.com/ChillCode/wc-untappd-ratings
 *
 *
 * Copyright (C) 2024 ChillCode
 * Released under the General Public License v3.0
 * https://www.gnu.org/licenses/gpl-3.0.html
 *
*/
!function(d){d.fn.UntappdMap=function(n){var e=d.extend({zoom:"4",height:"500",width:"640",api_key:"",brewery_id:0,max_checkins:25,center_map:"no",center_lat:"34.2346598",center_lng:"-77.9482096",map_use_icon:!1,map_use_url_icon:"",map_type:"interactive"},n);checkconfig=function(){return ajax_untappd_config.ajax_url?!!e.api_key||(console.warn("[Untappd Ratings for WooCommerce] Google Javascript API key is required to initialize the map."),!1):(console.warn("[Untappd Ratings for WooCommerce] URL is required to initialize the map, check configuration."),!1)},init=function(n,e){if(!1===checkconfig())return!1;var a=new google.maps.LatLng(e.center_lat,e.center_lng),a={zoom:e.zoom,center:a,scrollwheel:!1,scaleControl:!0,zoomControl:!0,zoomControlOptions:{style:google.maps.ZoomControlStyle.SMALL,position:google.maps.ControlPosition.RIGHT_CENTER},streetViewControl:!1,mapTypeControl:!0},n=document.getElementById(n.id);n&&(n=new google.maps.Map(n,a),"yes"===e.center_map&&(a=new google.maps.LatLng(e.center_lat,e.center_lng),n.setCenter(a)),load_markers(n,e.map_use_icon,e.map_use_url_icon))},load_markers=function(c,p,l){var n=d.ajax({url:ajax_untappd_config.ajax_url,dataType:"json",type:"GET",data:{action:"wc_untappd_map_feed",wc_untappd_map_nonce:ajax_untappd_config.wc_untappd_map_nonce,brewery_id:e.brewery_id,max_checkins:e.max_checkins}}),_=(n.done(function(n){if(n)for(var e in n)n.hasOwnProperty(e)&&!function(n){var e,a={},t="",o=[];for(e in n)if(n.hasOwnProperty(e)){if(!n[e].lat||!n[e].lng)return;a={lat:n[e].lat,lng:n[e].lng},t=n[e].venue_name,o.push({data:n[e],html:getHtmlInfoWindow(n[e])})}p?i={path:"m24.145 3.2668c-4.9298 9.8904-5.2263 9.421-5.4302 10.7l-0.32123 2.0263c-0.11747 0.74134-0.40772 1.4518-0.84633 2.0634l-9.1986 12.837c-0.4695 0.65483-1.2602 1.0008-2.0633 0.90194-2.4896-0.30888-4.8062-1.9892-5.8873-4.2317-0.35213-0.72897-0.27799-1.5938 0.1915-2.2487l9.1986-12.843c0.43861-0.61161 1.0131-1.112 1.6803-1.4641l1.8101-0.95752c1.1429-0.60543 0.59925-0.73515 8.3769-8.5808 0.06193-0.29653 0.06193-0.45096 0.22231-0.49422 0.18544-0.043224 0.40774-0.061934 0.38919-0.28415l-0.02534-0.2842c-0.01267-0.11747 0.08029-0.22232 0.19782-0.22232 0.278-0.004737 0.81546 0.074013 1.5815 0.61778 0.75985 0.54981 1.0131 1.0379 1.0934 1.3035 0.03718 0.1112-0.03718 0.22864-0.14829 0.25946l-0.27802 0.067974c-0.20993 0.05554-0.15435 0.27181-0.14198 0.45714 0.0047 0.17306-0.14199 0.22232-0.40154 0.37684zm-10.576-0.83398c0.20994 0.05554 0.15436 0.27181 0.14198 0.45714-0.01267 0.16675 0.1296 0.21626 0.39538 0.37067 0.48804 0.98225 0.94518 1.8842 1.3714 2.7182 0.04322 0.08029 0.14198 0.092724 0.20387 0.03079 0.69189-0.74134 1.5197-1.6186 2.502-2.6317 0.08029-0.086448 0.08645-0.21626 0.0047-0.30271-0.49416-0.50658-1.0193-1.044-1.5814-1.6124-0.061934-0.29036-0.061934-0.45098-0.22231-0.49423-0.18544-0.0495-0.40774-0.061934-0.38919-0.28416 0.017644-0.20389 0.086447-0.5004-0.17305-0.50657-0.27801-0.0047368-0.81546 0.067974-1.5815 0.61778-0.75985 0.54981-1.0131 1.0378-1.0934 1.3035-0.08645 0.25946 0.22232 0.28416 0.42009 0.3336zm24.087 22.876-9.1924-12.843c-0.81546-1.1429-1.6433-1.4456-3.4842-2.4154-0.69191-0.36451-0.87724-0.67338-1.8842-1.7854-0.06193-0.067974-0.17912-0.05554-0.22232 0.03079-2.8603 5.4858-2.9097 5.1151-3.0271 5.8565-0.10516 0.66099-0.08029 1.2355 0.01764 1.8409 0.11747 0.74134 0.40772 1.4518 0.84634 2.0634l9.1986 12.843c0.46953 0.65483 1.2479 1.0008 2.0448 0.9081 2.4896-0.30268 4.8186-1.9769 5.912-4.2379 0.3336-0.73515 0.26564-1.6-0.20995-2.261z",fillColor:"#2ad2c5",fillOpacity:1,strokeWeight:.5,strokeColor:"#000000",size:new google.maps.Size(38,32),origin:new google.maps.Point(0,0),anchor:new google.maps.Point(19,0)}:l&&(i={url:l});var i=new google.maps.Marker({position:a,map:c,title:t,icon:i}),r=new google.maps.InfoWindow({content:'<div id="infowindow-container"></div><div id="infowindow-pagination-container"></div>',maxWidth:380,ariaLabel:t});google.maps.event.addListener(r,"domready",function(){1<o.length?d("#infowindow-pagination-container").pagination({dataSource:o,pageSize:1,autoHidePrevious:!1,autoHideNext:!1,showPageNumbers:!1,showNavigator:!0,showGoButton:!0,showGoInput:!0,formatNavigator:"<%= currentPage %> / <%= totalPage %>",callback:function(n,e){d("#infowindow-container").html(n[0].html)}}):d("#infowindow-container").html(d(o[0].html))}),google.maps.event.addListener(i,"click",function(a){return function(){for(var n=0,e=_.length;n<e;n++)_[n].close();_.push(r),r.open(c,a)}}(i))}(n[e])}),n.fail(function(n,e){console.log(n)}),getHtmlInfoWindow=function(n){location_data="",n.location&&(n.location="("+n.location+")",location_data=d("<a>").attr({rel:"noopener noreferer",target:"_blank",href:"https://www.google.com/maps/search/?api=1&query="+n.location}).text(n.location)),rating_score="",n.rating_score&&(rating_score=d("<div>").attr({class:"checkin_rating"}).append(d("<h5>").text("Rating:")).append(d("<p>").html(d("<b>").text(n.rating_score+"/5")))),checkin_comment=checkin_comment_translated="",n.comment&&(checkin_comment=d("<div>").attr({class:"checkin_comment"}).append(d("<h5>").text(ajax_untappd_config.languages[1]+":")).append(d("<p>").html(d("<b>").text(n.comment))),checkin_comment_translated=d("<div>").attr({id:"untappd_comment_translated_hide"}).append(d("<h5>").text(ajax_untappd_config.languages[2]+":")).append(d("<p>").attr({class:"untappd_comment_translated"}).html(d("<b>").text(n.comment+"/5")))),data_venue="",n.venue_name&&(data_venue=(n.foursquare_url&&"Untappd at Home"!=n.venue_name?d("<a>").attr({style:"text-decoration:underline",target:"_blank",href:n.foursquare_url}):d("<b>")).text(n.venue_name)),product_link="",n.permalink&&(product_link=d("<a>").attr({style:"display:block;width:100%;",target:"_blank",href:n.permalink}).text(ajax_untappd_config.languages[5]),product_link=d("<div>").append(d("<p>").attr({class:"product woocommerce add_to_cart_inline",style:"font-size:1em;border:1px solid #ccc;padding:6px;text-align: center;text-transform: uppercase;margin-top: 10px;"}).html(product_link)));var e=d("<div>").attr({class:"checkin_title"}).append(d("<h5>").text(n.beer_name)),a=d("<div>").attr({class:"checkin_img"}).append(d('<img loading="lazy">').attr({alt:n.beer_name,src:n.beer_label})),n=d("<div>").attr({class:"checkin_desc"}).append(d("<b>").html(n.user_name+" ")).append(d("<b>").html(function(){return location_data})).append(" "+ajax_untappd_config.languages[3]+" ").append(d("<b>").html(n.beer_name)).append(" "+ajax_untappd_config.languages[4]+" ").append(data_venue).append(" "+ajax_untappd_config.languages[0]+" "+n.checkin_date).append(product_link).append(rating_score).append(checkin_comment).append(checkin_comment_translated);return d("<div>").attr({class:"infowindow-content"}).append(e).append(a).append(n)},[])},init_static=function(c,p){if(!1===checkconfig())return!1;var n=d.ajax({url:ajax_untappd_config.ajax_url,dataType:"json",type:"GET",data:{action:"wc_untappd_map_feed",wc_untappd_map_nonce:ajax_untappd_config.wc_untappd_map_nonce,brewery_id:p.brewery_id,max_checkins:p.max_checkins}});n.done(function(n){if(n){parseInt(p.height)<=0&&(p.height=400);var e,a=jQuery("#"+c.id).parent(),t=[],o=("yes"===p.center_map&&(t=[p.center_lat,p.center_lng]),"&markers=size:small%7Ccolor:0x2ad2c5%7C");for(e in p.map_use_url_icon&&(o="&markers=icon:"+encodeURIComponent(p.map_use_url_icon)+"%7C"),n)if(n.hasOwnProperty(e))for(var i in n[e])if(n[e].hasOwnProperty(i)){if(!n[e][i].lat||!n[e][i].lng)return!1;"yes"!==p.center_map&&(t=[n[e][i].lat,n[e][i].lng]),o=o+n[e][i].lat+","+n[e][i].lng+"%7C";break}var r='<img src="https://maps.googleapis.com/maps/api/staticmap?center='+t.toString()+"&language="+ajax_untappd_config.map_current_lang+"&zoom="+p.zoom+"&size="+p.width+"x"+p.height+o+"&scale=1&key="+p.api_key+'">';a.find(".untappd_map").append(r)}}),n.fail(function(n,e){console.warn("[Untappd Ratings for WooCommerce] Request failed: "+e)})},this.each(function(){("static"===e.map_type?init_static:init)(this,e)})}}(jQuery);
